@Html.Partial("Header")
@{
    Style.Require("Flow");
    HtmlHelper.ClientValidationEnabled = true;
    HtmlHelper.UnobtrusiveJavaScriptEnabled = true;
    Layout.Title = T("Flow Search").ToString();
    Script.Require("Flow").AtFoot();
}

<style>
    .header-main {
        display: none;
    }
    #masContent {
        width: 100% !important;
    }
    /*canvas { border: 1px solid red; }*/
    .row-fluid [class*="span"] {
        margin-left: 1px !important;
    }
    .map-result img {
        max-width: none;
    }
</style>
<script src="~/Modules/EXPEDIT.Share/Scripts/vis.js"></script>
@*<script src="~/Modules/EXPEDIT.Share/Scripts/nprogress.js"></script>*@
<script type="text/javascript">
    var mapHelper = '@Url.Content("~/Modules/NKD/Scripts/NKD.maps.js")';
</script>
<link type="text/css" rel="stylesheet" href="~/Modules/EXPEDIT.Share/Styles/vis.css">
<link type="text/css" rel="stylesheet" href="~/Modules/EXPEDIT.Share/Styles/emberui.css">
<link type="text/css" rel="stylesheet" href="~/Modules/EXPEDIT.Share/Styles/emberui-default-theme.css">
@*<link type="text/css" rel="stylesheet" href="~/Modules/EXPEDIT.Share/Styles/nprogress.css">*@



<!-- The ember app gets injected here -->
<div id="emberapphere" name="application"></div>


<script type="text/x-handlebars" id="application">
    {{outlet}}
</script>




  <script type="text/x-handlebars" id="components/viz-editor"></script>


  <script type="text/x-handlebars" id="wikipedia">
      <h1>{{title}}</h1>
      <div class="container-fluid" style="margin-top:12px;">
        <div class="row-fluid">
            <div class="span6">
                {{#if model.content}}
                  {{safehtml model.content}}
                {{/if}}
            </div>
            <div class="span6">
                 {{viz-editor data=graphData selected=selected}}
            </div>
        </div>
      </div>

  </script>


  <script type="text/x-handlebars" id="graph">
      <div class="container-fluid" style="margin-top:12px;">
           <h1>{{model.label}}</h1>
           {{#if model.node.workflows}}
                {{view Ember.Select content=model.node.workflows  optionValuePath="content.id" optionLabelPath="content.label" value=workflowID disabled='graphDataLte2'}}
                <a {{action "toggleWorkflowNameModal"}}  class="hlink">Edit Name</a>
            {{/if}}
            {{#eui-modal openBinding="workflowNameModal" style="full"}}
                <div style="padding: 50px; text-align: center;">
                <p>
                    Please enter a workflow name:
                </p>
                {{eui-input valueBinding="workflowName" placeholder='Enter a workflow name' error=validateWorkflowName forceErrorCheck=true}} <br /><br />
                <p>
                    Please enter a process name:
                </p>
                {{eui-input valueBinding="workflowName" placeholder='Enter a process name' error=validateWorkflowName forceErrorCheck=true}} <br /><br />
                <p>
                    Please enter process detail:
                </p>
                {{eui-input valueBinding="workflowName" placeholder='Enter a workflow name' error=validateWorkflowName forceErrorCheck=true}} <br /><br />
                {{eui-button label="Submit" size="small" action="toggleWorkflowNameModal" style='primary' size='large' disabled=validateWorkflowName loading=loadingWorkflowName}}                    
                </div>
            {{/eui-modal}}
                        
            <br>

           <div class="container-fluid" style="margin-top:12px;">
           <div class="row-fluid">
              <div class="span6">
                    {{safehtml model.content}}
              </div>
              <div class="span6">
                  {{viz-editor data=graphData selected=selected editing=editing openModal='openModal'}}
              </div>
           </div>
      </div>
  </script>






<!--  <script type="text/x-handlebars" id="loading">
    <h1>Loading...</h1>
  </script>-->


  <script type="text/x-handlebars" id="search">
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span12">
          {{#link-to 'graph' tagName='button'}}Create new workflow{{/link-to}}
          <button><a href="/flow/wiki">Create new page</a></button>
          <button onclick='alert('This is still a to-do')'>Add location to database</button>
        </div>
      </div>
      <br>

      <div class="row-fluid">
        <div class="span12">
          <div class="search-wrapper">
            <div class="input-wrapper">
              <div class="input">

                {{! show all the available tags}}
                {{#each tag in tags}}
                  <span  {{action 'deleteTag' tag}} class="tag">{{tag.n}}</span>
                {{/each}}

                {{! input box }}
                {{view Ember.TextField action='search' valueBinding="keywords" type='text' placeholder="Add keywords" autofocus="autofocus"}}

              {{! location }}
@*              {{#flow-modal name="locationModal" fade=true footerButtonsBinding="locationModalBtn" title="Add a location filter!"}}
                      {{view Ember.TextField valueBinding="searchLocation" type='text' id='searchLocation' placeholder="Enter your location"}}
                      <div id="map-search" style="width: 100%; height: 30vh"></div>
              {{/flow-modal}}*@
              <span {{action 'showLocationModal'}} class="glyphicon icon-globe"></span>



            {{#eui-modal openBinding="dateModal" style="full"}}
                <div style="padding: 50px; text-align: center;">
                <p>
                    Please choose a starting and ending date for the filter:
                </p>
                {{eui-selectdate style="default" valueBinding='sched_date_from' placeholder="Starting date"}}
                {{eui-selectdate style="default" valueBinding='sched_date_to' placeholder="Ending date" showNextMonth=false}}

                {{!eui-calendar selectionBinding='sched_date_from' showNextMonth=false}}
                    
                {{!eui-calendar selectionBinding='sched_date_to' showNextMonth=false}}

                <br /><br />

                {{eui-button label="Cancel" action="toggleDateModal" size='large'}}                    
                {{eui-button label="Submit" action="addDate" style='primary' size='large'}}                    
                </div>
            {{/eui-modal}}
              <span {{action 'toggleDateModal'}} class="glyphicon icon-calendar"></span>
            </div>

            {{! search }}
            &nbsp;
            <button {{action 'search'}} type="button" class="btn btn-primary">
              <span class="glyphicon icon-search"></span>Search
            </button>

            Pagesize:
            {{view Ember.Select content=pageSizes value=pageSize }}

            Processes:
            {{view Ember.Checkbox checkedBinding='graph'}}

            Files:
            {{view Ember.Checkbox checkedBinding='file'}}

            Process Locations:
            {{view Ember.Checkbox checkedBinding='map'}}
            <br />
             {{#if keywords}}
                {{#link-to 'wikipedia' componentURI}}Research {{keywords}} from wikipedia{{/link-to}}
            {{/if}}
          </div>
        </div>
      </div>
      <br/>
      <br/>
    </div>

      <div class="row-fluid">
        {{#if graph}}
          <div {{bind-attr class='activeResultsClass :overscroll'}}>
            {{render 'graphResults'}}
          </div>
        {{/if}}
        {{#if file}}
          <div {{bind-attr class='activeResultsClass :overscroll'}}>
            {{render 'fileResults'}}
          </div>
        {{/if}}
        {{#if map}}
          <div {{bind-attr class='activeResultsClass :overscroll'}}>
            {{render 'mapResults'}}
          </div>
        {{/if}}

      </div>

    </div>


  </script>

  <style>

  .overscroll {
  /*overflow-y: scroll;*/
  /*overflow-x: auto;*/
  }

  </style>



<script type="text/x-handlebars" data-template-name="graphResults">
  <h2>Processes<small>&nbsp;&nbsp;<a {{action 'newProcess'}}><i class="glyphicon icon-plus-sign"></i>&nbsp;</a></small></h2>

  {{#if loading}}

    Loading...

  {{else}}

    {{#if results}}
      <ul class="pager">
          {{#if prev}}
             <li><a {{action 'prev' 'pageGraph'}}>Previous</a></li>
          {{/if}}
          {{#if next}}
            <li><a {{action 'next' 'pageGraph'}}>Next</a></li>
          {{/if}}
      </ul>


      <div class="table-responsive" style="padding:12px;">
        <table class="table table-condensed table-hover">
            <thead>
              <tr>
                <th>Title</th>
                <th>Author</th>
                <th>Updated</th>
              </tr>
            </thead>
            <tbody>
              {{#each result in results}}
                {{#link-to 'graph' result.ReferenceID tagName='tr'}}

                  <td>{{safehtml result.Title}}</td>
                  <td>{{safehtml result.Author}}</td>
                  <td>{{safehtml result.Updated}}</td>
                {{/link-to}}
              {{/each}}
            </tbody>
        </table>
      </div>
    {{else}}

        Sorry no results could be found.

    {{/if}}

  {{/if}}

</script>


<script type="text/x-handlebars" data-template-name="fileResults">
  <h2>Files</h2>

  {{#if loading}}

    Loading...

  {{else}}


    {{#if results}}

      <ul class="pager">
          {{#if prev}}
             <li><a {{action 'prev' 'pageFile'}}>Previous</a></li>
          {{/if}}
          {{#if next}}
            <li><a {{action 'next' 'pageFile'}}>Next</a></li>
          {{/if}}
      </ul>

      <div class="table-responsive" style="padding:12px;">
        <table class="table table-condensed table-hover">
            <thead>
              <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Author</th>
                <th>Updated</th>
                <th>Link</th>
              </tr>
            </thead>
            <tbody>
              {{#each result in results}}
                <tr>
                  <td>{{safehtml result.Title}}</td>
                  <td>{{safehtml result.Description}}</td>
                  <td>{{safehtml result.Author}}</td>
                  <td>{{safehtml result.Updated}}</td>
                  <td><a {{bind-attr href=result.ResourcePath}}>Download File</a></td>
                </tr>
              {{/each}}
            </tbody>
        </table>
      </div>

    {{else}}

        Sorry no results could be found.

    {{/if}}


  {{/if}}

</script>



<script type="text/x-handlebars" id="components/map-result">
      <div {{bind-attr id='id'}} style="width: 100%; height: 75vh; padding:12px;" class="map-result"></div>
</script>


<script type="text/x-handlebars" data-template-name="mapResults">
  <h2>Process Locations</h2>

  {{#if loading}}

    Loading...

  {{else}}

    {{#if results}}
      <ul class="pager">
          {{#if prev}}
             <li><a {{action 'prev' 'pageMap'}}>Previous</a></li>
          {{/if}}
          {{#if next}}
            <li><a {{action 'next' 'pageMap'}}>Next</a></li>
          {{/if}}
      </ul>

    {{else}}

        Sorry no results could be found.

    {{/if}}

  {{/if}}

  {{map-result resultsGeo=resultsGeo visi=visi}}

</script>


